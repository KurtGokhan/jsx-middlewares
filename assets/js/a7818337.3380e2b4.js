"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[255],{9898:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"best-practices","title":"Best Practices","description":"If you are reading this documentation, it is probably because JSX Middlewares are a new concept for you. There may be some pitfalls that you may not be aware of. This section will help you to avoid them, and use JSX Middlewares in the best way possible.","source":"@site/docs/best-practices.mdx","sourceDirName":".","slug":"/best-practices","permalink":"/jsx-middlewares/best-practices","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Active Wheel Event Handler Directive","permalink":"/jsx-middlewares/examples/on-wheel-active"}}');var t=i(2540),r=i(3023);const o={sidebar_position:3},d="Best Practices",a={},l=[{value:"Use responsibly",id:"use-responsibly",level:2},{value:"Understand the JSX",id:"understand-the-jsx",level:2},{value:"Understand the order of middlewares",id:"understand-the-order-of-middlewares",level:2},{value:"Avoid side effects",id:"avoid-side-effects",level:2},{value:"Avoid infinite recursion",id:"avoid-infinite-recursion",level:2},{value:"Remember the rules of hooks",id:"remember-the-rules-of-hooks",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"best-practices",children:"Best Practices"})}),"\n",(0,t.jsx)(n.p,{children:"If you are reading this documentation, it is probably because JSX Middlewares are a new concept for you. There may be some pitfalls that you may not be aware of. This section will help you to avoid them, and use JSX Middlewares in the best way possible."}),"\n",(0,t.jsx)(n.h2,{id:"use-responsibly",children:"Use responsibly"}),"\n",(0,t.jsx)(n.p,{children:"JSX Middlewares give you a lot of control over your JSX. However, this can be a double-edged sword. If you are not careful, you can end up with a lot of middlewares that are hard to understand. It is recommended to use JSX Middlewares only when you need them, and to keep them simple."}),"\n",(0,t.jsx)(n.p,{children:"Middlewares can't do anything React itself can't do. But it can do some things the JSX syntax alone can't do."}),"\n",(0,t.jsx)(n.p,{children:"If you see yourself writing a lot of the same code in your JSX, it may be a good idea to write a middleware for it. In this regard, JSX Middlewares are similar to Higher Order Components (HOCs). It is also similar to Angular directives."}),"\n",(0,t.jsx)(n.h2,{id:"understand-the-jsx",children:"Understand the JSX"}),"\n",(0,t.jsx)(n.p,{children:"JSX Middlewares are called for every JSX element in your application. It is important to understand how JSX works to be able to avoid pitfalls. It is especially important if you are a library developer, and you want to write middlewares that work with any JSX. You can't assume that the JSX will be written in a certain way."}),"\n",(0,t.jsx)(n.p,{children:"Some of the things to keep in mind are:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"type"})," is the rendered component. It can be a ",(0,t.jsx)(n.code,{children:"string"}),", ",(0,t.jsx)(n.code,{children:"function"})," or ",(0,t.jsx)(n.code,{children:"class"}),". But it can also be a React Fragment, in which case it is a ",(0,t.jsx)(n.code,{children:"symbol"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"props"})," is the object which includes all the props passed to the rendered component. Remember that ",(0,t.jsx)(n.code,{children:"key"})," can't be accessed from ",(0,t.jsx)(n.code,{children:"props"}),". It is a separate argument."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"props"})," can include the ",(0,t.jsx)(n.code,{children:"children"})," passed to a component. It is important to understand that the ",(0,t.jsx)(n.code,{children:"children"})," is not always a ",(0,t.jsx)(n.code,{children:"string"})," or ",(0,t.jsx)(n.code,{children:"ReactNode"}),". It can be any JavaScript value, including ",(0,t.jsx)(n.code,{children:"Array"}),", ",(0,t.jsx)(n.code,{children:"null"}),", ",(0,t.jsx)(n.code,{children:"undefined"})," or even functions."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"key"})," is the key passed to the rendered component. You should generally pass it to the next middleware as is."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"understand-the-order-of-middlewares",children:"Understand the order of middlewares"}),"\n",(0,t.jsx)(n.p,{children:"The order of middlewares is important. Middlewares are called in the reverse order they were added (LIFO). So, if you add middlewares like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"addMiddlewares(middleware1, middleware2);\naddMiddlewares(middleware3);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The order of execution will be ",(0,t.jsx)(n.code,{children:"middleware3"}),", ",(0,t.jsx)(n.code,{children:"middleware2"}),", ",(0,t.jsx)(n.code,{children:"middleware1"})," and lastly the original JSX factory."]}),"\n",(0,t.jsx)(n.h2,{id:"avoid-side-effects",children:"Avoid side effects"}),"\n",(0,t.jsx)(n.p,{children:"JSX Middlewares are not meant to be used for side effects. They need to be pure functions. They are meant to transform JSX elements into other JSX elements."}),"\n",(0,t.jsxs)(n.p,{children:["If you need to do side effects, you can wrap your JSX in a component that does the side effects. Check the example in ",(0,t.jsx)(n.a,{href:"#remember-the-rules-of-hooks",children:"Rules of hooks"})," section to see how to do this."]}),"\n",(0,t.jsx)(n.h2,{id:"avoid-infinite-recursion",children:"Avoid infinite recursion"}),"\n",(0,t.jsx)(n.p,{children:"It is possible to create infinite recursion with JSX Middlewares if you are not careful. This often happens when you unconditionally create new JSX elements in a middleware."}),"\n",(0,t.jsxs)(n.p,{children:["For example, a middleware like below will cause infinite recursion, because creating a ",(0,t.jsx)(n.code,{children:"div"})," will call this middleware again, and so on."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"function wrapMiddleware(next, type, props, key) {\n  return <div>{next(type, props, key)}</div>;\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["There are several ways to fix this. For example, by adding a condition to wrap in a ",(0,t.jsx)(n.code,{children:"div"})," only if the ",(0,t.jsx)(n.code,{children:"type"})," is not already a ",(0,t.jsx)(n.code,{children:"div"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["It is also a good idea to run the logic of the middleware only if a specific prop is passed to the element. To distinguish such props, it can be a good idea to prefix them with ",(0,t.jsx)(n.code,{children:"$"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Another way to solve this is to use the ",(0,t.jsx)(n.code,{children:"original"})," property of ",(0,t.jsx)(n.code,{children:"next"})," to create JSX elements without middlewares."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"function wrapMiddleware(next, type, props, key) {\n  const children = next(type, props, key);\n  return next.original('div', { children }, key);\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"remember-the-rules-of-hooks",children:"Remember the rules of hooks"}),"\n",(0,t.jsx)(n.p,{children:"You cannot use hooks in JSX middlewares. This is because middlewares are not components, and hooks can only be used in components."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"function exampleMiddleware(next, type, props, key) {\n  // error-start\n  // Don't use hooks in middlewares!\n  const [count, setCount] = useState(0);\n  // error-end\n  return next(type, props, key);\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Instead, you can wrap your JSX in a components that uses hooks. See ",(0,t.jsx)(n.a,{href:"/examples/with-click-count",children:"Button Click Counter"})," for an example."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},3023:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>d});var s=i(3696);const t={},r=s.createContext(t);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);
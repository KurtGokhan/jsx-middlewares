/*! For license information please see a7818337.18d4f72a.js.LICENSE.txt */
"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[115],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),d=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=d(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(n),m=o,f=p["".concat(s,".").concat(m)]||p[m]||u[m]||i;return n?r.createElement(f,a(a({ref:t},c),{},{components:n})):r.createElement(f,a({ref:t},c))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:o,a[1]=l;for(var d=2;d<i;d++)a[d]=n[d];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1007:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(6010),o=n(7294);const i={browserWindow:"browserWindow_my1Q",browserWindowHeader:"browserWindowHeader_jXSR",row:"row_KZDM",buttons:"buttons_uHc7",right:"right_oyze",browserWindowAddressBar:"browserWindowAddressBar_Pd8y",dot:"dot_giz1",browserWindowMenuIcon:"browserWindowMenuIcon_Vhuh",bar:"bar_rrRL",browserWindowBody:"browserWindowBody_Idgs"};function a(e){let{children:t,minHeight:n,url:a="http://localhost:3000",style:l,bodyStyle:s}=e;return o.createElement("div",{className:i.browserWindow,style:{...l,minHeight:n}},o.createElement("div",{className:i.browserWindowHeader},o.createElement("div",{className:i.buttons},o.createElement("span",{className:i.dot,style:{background:"#f25f58"}}),o.createElement("span",{className:i.dot,style:{background:"#fbbe3c"}}),o.createElement("span",{className:i.dot,style:{background:"#58cb42"}})),o.createElement("div",{className:(0,r.Z)(i.browserWindowAddressBar,"text--truncate")},a),o.createElement("div",{className:i.browserWindowMenuIcon},o.createElement("div",null,o.createElement("span",{className:i.bar}),o.createElement("span",{className:i.bar}),o.createElement("span",{className:i.bar})))),o.createElement("div",{className:i.browserWindowBody,style:s},t))}},9752:(e,t,n)=>{function r(e,t,n){return o([],e,t,n)}function o(e,t,n,r){let i,a,l,s;function d(){a=c(t?.bind(null)),l=c(n?.bind(null)),s=function(e,t,n,o,i,a){return c((function(e,t,n){return r(e,t,n,o,i,a)}))(e,t,n)}}function c(t){let n=t;n&&(n.context=i,n.original=t);for(let r=0;r<e.length;r++){const o=e[r];o&&(n=o.bind(null,n),n.context=i,n.original=t)}return n}return void 0===e&&(e=[]),n??=t,r??=t,i={addMiddlewares:function(){return e.push(...arguments),d(),i},removeMiddlewares:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const o of n){const t=e.indexOf(o);t>-1&&e.splice(t,1)}return d(),i},clearMiddlewares:function(){return e.length=0,d(),i},jsxClassic:function(e,t){let n;({key:n,...t}=t||{});for(var r=arguments.length,o=new Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];if(null!=o&&o.length>0){if(1===o.length)return t.children=o[0],a(e,t,n);t.children=o}return l(e,t,n)},jsx:function(e,t,n){return a(e,t,n)},jsxs:function(e,t,n){return l(e,t,n)},jsxDEV:function(e,t,n,r,o,i){return s(e,t,n,r,o,i)},clone:function(i,a,l){return o(e,i||t,a||n,l||r)}},d(),i}n.d(t,{P:()=>a});var i=n(5893);function a(){return r(i.jsx,i.jsxs)}},1801:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>m,default:()=>b,frontMatter:()=>u,metadata:()=>f,toc:()=>w});var r=n(7462),o=n(7294),i=n(3905),a=n(1007);const l=(0,n(9752).P)(),s=l.jsxClassic;function d(e){let{render:t,props:n,type:r}=e;const[i,a]=(0,o.useState)(0);return n={...n,onClick:()=>a(i+1),children:[n.children,` - Clicked ${i} times`]},t(r,n)}function c(){return s("button",{$withClickCount:!0},"Click me")}function p(){return s(a.Z,null,s(c,null))}l.addMiddlewares((function(e,t,n,r){if(n.$withClickCount){const{$withClickCount:o,...i}=n;return s(d,{render:e,type:t,props:i,key:r})}return e(t,n,r)}));const u={sidebar_position:3},m="Best Practices",f={unversionedId:"best-practices",id:"best-practices",title:"Best Practices",description:"If you are reading this documentation, it is probably because JSX Middlewares are a new concept for you. There may be some pitfalls that you may not be aware of. This section will help you to avoid them, and use JSX Middlewares in the best way possible.",source:"@site/docs/best-practices.mdx",sourceDirName:".",slug:"/best-practices",permalink:"/jsx-middlewares/best-practices",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Ripple",permalink:"/jsx-middlewares/examples/ripple"}},h={},w=[{value:"Use responsibly",id:"use-responsibly",level:2},{value:"Understand the JSX",id:"understand-the-jsx",level:2},{value:"Understand the order of middlewares",id:"understand-the-order-of-middlewares",level:2},{value:"Avoid side effects",id:"avoid-side-effects",level:2},{value:"Avoid infinite loops",id:"avoid-infinite-loops",level:2},{value:"Remember the rules of hooks",id:"remember-the-rules-of-hooks",level:2}],y={toc:w},k="wrapper";function b(e){let{components:t,...n}=e;return(0,i.kt)(k,(0,r.Z)({},y,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"best-practices"},"Best Practices"),(0,i.kt)("p",null,"If you are reading this documentation, it is probably because JSX Middlewares are a new concept for you. There may be some pitfalls that you may not be aware of. This section will help you to avoid them, and use JSX Middlewares in the best way possible."),(0,i.kt)("h2",{id:"use-responsibly"},"Use responsibly"),(0,i.kt)("p",null,"JSX Middlewares give you a lot of control over your JSX. However, this can be a double-edged sword. If you are not careful, you can end up with a lot of middlewares that are hard to understand. It is recommended to use JSX Middlewares only when you need them, and to keep them simple."),(0,i.kt)("p",null,"Middlewares can't do anything React itself can't do. But it can do some things the JSX syntax alone can't do."),(0,i.kt)("p",null,"If you see yourself writing a lot of the same code in your JSX, it may be a good idea to write a middleware for it. In this regard, JSX Middlewares are similar to Higher Order Components (HOCs). It is also similar to Angular directives."),(0,i.kt)("h2",{id:"understand-the-jsx"},"Understand the JSX"),(0,i.kt)("p",null,"JSX Middlewares are called for every JSX element in your application. It is important to understand how JSX works to be able to avoid pitfalls. It is especially important if you are a library developer, and you want to write middlewares that work with any JSX. You can't assume that the JSX will be written in a certain way."),(0,i.kt)("p",null,"Some of the things to keep in mind are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"type")," is the rendered component. It can be a ",(0,i.kt)("inlineCode",{parentName:"li"},"string"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"function")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"class"),". But it can also be a React Fragment, in which case it is a ",(0,i.kt)("inlineCode",{parentName:"li"},"symbol"),"."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"props")," is the object which includes all the props passed to the rendered component. Remember that ",(0,i.kt)("inlineCode",{parentName:"li"},"key")," can't be accessed from ",(0,i.kt)("inlineCode",{parentName:"li"},"props"),". It is a separate argument."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"props")," can include the ",(0,i.kt)("inlineCode",{parentName:"li"},"children")," passed to a component. It is important to understand that the ",(0,i.kt)("inlineCode",{parentName:"li"},"children")," is not always a ",(0,i.kt)("inlineCode",{parentName:"li"},"string")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"ReactNode"),". It can be any JavaScript value, including ",(0,i.kt)("inlineCode",{parentName:"li"},"Array"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"null"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"undefined")," or even functions."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"key")," is the key passed to the rendered component. You should generally pass it to the next middleware as is.")),(0,i.kt)("h2",{id:"understand-the-order-of-middlewares"},"Understand the order of middlewares"),(0,i.kt)("p",null,"The order of middlewares is important. Middlewares are called in the reverse order they were added (LIFO). So, if you add middlewares like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"addMiddlewares(middleware1, middleware2);\naddMiddlewares(middleware3);\n")),(0,i.kt)("p",null,"The order of execution will be ",(0,i.kt)("inlineCode",{parentName:"p"},"middleware3"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"middleware2"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"middleware1")," and lastly the original JSX factory."),(0,i.kt)("h2",{id:"avoid-side-effects"},"Avoid side effects"),(0,i.kt)("p",null,"JSX Middlewares are not meant to be used for side effects. They need to be pure functions. They are meant to transform JSX elements into other JSX elements."),(0,i.kt)("p",null,"If you need to do side effects, you can wrap your JSX in a component that does the side effects. Check the example in ",(0,i.kt)("a",{parentName:"p",href:"#remember-the-rules-of-hooks"},"Rules of hooks")," section to see how to do this."),(0,i.kt)("h2",{id:"avoid-infinite-loops"},"Avoid infinite loops"),(0,i.kt)("p",null,"It is possible to create infinite loops with JSX Middlewares if you are not careful. This often happens when you unconditionally create new JSX elements in a middleware."),(0,i.kt)("p",null,"For example, a middleware like this will cause infinite loops, because creating a ",(0,i.kt)("inlineCode",{parentName:"p"},"div")," will call this middleware again, and so on."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"function wrapMiddleware(next, type, props, key) {\n  return <div>{next(type, props, key)}</div>;\n}\n")),(0,i.kt)("p",null,"There are several ways to fix this. For example, by adding a condition to wrap in a ",(0,i.kt)("inlineCode",{parentName:"p"},"div")," only if the ",(0,i.kt)("inlineCode",{parentName:"p"},"type")," is not already a ",(0,i.kt)("inlineCode",{parentName:"p"},"div"),"."),(0,i.kt)("p",null,"It is also a good idea to run the logic of the middleware only if a specific prop is passed to the element. To distinguish such props, it can be a good idea to prefix them with ",(0,i.kt)("inlineCode",{parentName:"p"},"$"),"."),(0,i.kt)("p",null,"Another way to solve this is to use the ",(0,i.kt)("inlineCode",{parentName:"p"},"original")," property of ",(0,i.kt)("inlineCode",{parentName:"p"},"next")," to create JSX elements without middlewares."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"function wrapMiddleware(next, type, props, key) {\n  const children = next(type, props, key);\n  return next.original('div', { children }, key);\n}\n")),(0,i.kt)("h2",{id:"remember-the-rules-of-hooks"},"Remember the rules of hooks"),(0,i.kt)("p",null,"You cannot use hooks in JSX middlewares. But you can wrap your JSX in a components that uses hooks."),(0,i.kt)("p",null,"For example, let's say we want to write a middleware that adds the click count to an element. Writing it like this would be wrong:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"// error-start\n\nfunction withClickCountMiddleware(next, type, props, key) {\n  const [count, setCount] = useState(0);\n\n  if (props.$withClickCount) {\n    const { $withClickCount, ...restProps } = props;\n    props = {\n      ...restProps,\n      onClick: () => setCount(count + 1),\n      children: [props.children, ` - Clicked ${count} times`],\n    };\n  }\n\n  return next(type, props, key);\n}\n\n// error-end\n")),(0,i.kt)("p",null,"Instead, you can write it with a component:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"function WithClickCount({ render, props, type }) {\n  const [count, setCount] = useState(0);\n\n  props = {\n    ...props,\n    onClick: () => setCount(count + 1),\n    children: [props.children, ` - Clicked ${count} times`],\n  };\n\n  return render(type, props);\n}\n\nfunction withClickCountMiddleware(next, type, props, key) {\n  if (props.$withClickCount) {\n    const { $withClickCount, ...restProps } = props;\n    return <WithClickCount render={next} type={type} props={restProps} key={key} />;\n  }\n\n  return next(type, props, key);\n}\n\naddMiddlewares(withClickCountMiddleware);\n\nfunction App() {\n  return <button $withClickCount>Click me</button>;\n}\n")),(0,i.kt)(p,{mdxType:"WithClickCountExample"}))}b.isMDXComponent=!0},5251:(e,t,n)=>{n(7418);var r=n(7294),o=60103;if(60107,"function"==typeof Symbol&&Symbol.for){var i=Symbol.for;o=i("react.element"),i("react.fragment")}var a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l=Object.prototype.hasOwnProperty,s={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,n){var r,i={},d=null,c=null;for(r in void 0!==n&&(d=""+n),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)l.call(t,r)&&!s.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:o,type:e,key:d,ref:c,props:i,_owner:a.current}}t.jsx=d,t.jsxs=d},5893:(e,t,n)=>{e.exports=n(5251)}}]);